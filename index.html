<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 è¥¿æ´‹æƒ…äººç¯€é è³¼ç³»çµ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; }
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #db2777;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-rose-50 min-h-screen py-8 px-4">
    <div class="max-w-md mx-auto bg-white rounded-3xl shadow-2xl overflow-hidden border border-rose-100">
        <div class="bg-rose-500 p-6 text-center text-white">
            <h1 class="text-2xl font-bold italic">ğŸŒ¹ 2026 Valentine's Day</h1>
            <p class="text-rose-100 mt-1">è¥¿æ´‹æƒ…äººç¯€é™æ™‚é è³¼</p>
        </div>

        <div class="p-6">
            <form id="orderForm" class="space-y-5">
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1">è¨‚è³¼äººå§“å</label>
                    <input type="text" name="name" placeholder="è«‹è¼¸å…¥å§“å" class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-rose-400 focus:border-transparent outline-none transition" required>
                </div>

                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1">è¯ç¹«é›»è©±</label>
                    <input type="tel" name="phone" placeholder="è«‹è¼¸å…¥æ‰‹æ©Ÿè™Ÿç¢¼" class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-rose-400 focus:border-transparent outline-none transition" required>
                </div>

                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1">é¸æ“‡é è³¼å“é …</label>
                    <div id="loadingStatus" class="flex items-center space-x-2 text-gray-400 text-sm mb-2">
                        <div class="loading-spinner"></div>
                        <span>æ­£åœ¨åŒæ­¥è©¦ç®—è¡¨å“é …...</span>
                    </div>
                    <select id="productSelect" name="productIndex" class="w-full px-4 py-2 border border-gray-300 rounded-xl bg-white focus:ring-2 focus:ring-rose-400 outline-none transition" required>
                        <option value="">è«‹é¸æ“‡...</option>
                    </select>
                </div>

                <div id="productPreview" class="hidden p-4 bg-rose-50 rounded-2xl flex items-center space-x-4 border border-rose-100">
                    <img id="previewImg" src="" class="w-20 h-20 object-cover rounded-lg shadow-sm">
                    <div class="flex-1">
                        <p id="previewSeries" class="text-xs text-rose-400 font-bold uppercase"></p>
                        <p id="previewName" class="text-gray-800 font-bold"></p>
                        <p id="previewPrice" class="text-rose-600 font-bold text-lg"></p>
                    </div>
                </div>

                <div class="flex space-x-4">
                    <div class="flex-1">
                        <label class="block text-sm font-bold text-gray-700 mb-1">è¨‚è³¼æ•¸é‡</label>
                        <input type="number" id="quantity" name="quantity" value="1" min="1" class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-rose-400 outline-none transition" required>
                    </div>
                    <div class="flex-1">
                        <label class="block text-sm font-bold text-gray-700 mb-1">é è¨ˆç¸½é‡‘é¡</label>
                        <div class="px-4 py-2 text-xl font-bold text-rose-600" id="totalAmount">$0</div>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1">å‚™è¨»èªªæ˜</label>
                    <textarea name="note" rows="2" placeholder="ç‰¹æ®Šéœ€æ±‚ã€æ”¶ä»¶è³‡è¨Šæˆ–å¡ç‰‡å…§å®¹..." class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-rose-400 outline-none transition"></textarea>
                </div>

                <button type="submit" id="submitBtn" class="w-full bg-rose-500 text-white py-4 rounded-2xl font-bold text-lg hover:bg-rose-600 transition-all shadow-lg active:scale-95 disabled:bg-gray-300">
                    ç¢ºèªé€å‡ºé è³¼å–®
                </button>
            </form>

            <div id="successMsg" class="hidden mt-6 p-6 bg-green-50 border border-green-200 rounded-2xl text-center">
                <p class="text-green-600 text-3xl mb-2">ğŸ‰</p>
                <p class="text-green-700 font-bold text-lg">é è³¼æäº¤æˆåŠŸï¼</p>
                <p class="text-green-600 text-sm mt-1">æˆ‘å€‘å°‡ç›¡å¿«è¯ç¹«æ‚¨ç¢ºèªè¨‚å–®ç´°ç¯€ã€‚</p>
                <button onclick="location.reload()" class="mt-4 text-sm text-green-700 underline">å†å¡«ä¸€ä»½</button>
            </div>
        </div>
    </div>

    <script>
        const scriptURL = 'https://script.google.com/macros/s/AKfycbzgJTRoha4m44NHZ8HrcJKcyKOc2IFprotnA4PPhDSONVVWNxfMB_jXksTxbFewm67Y/exec';
        const form = document.getElementById('orderForm');
        const select = document.getElementById('productSelect');
        const preview = document.getElementById('productPreview');
        const quantityInput = document.getElementById('quantity');
        const totalAmountDisp = document.getElementById('totalAmount');
        let productData = [];

        // 1. åˆå§‹åŒ–ï¼šæŠ“å– Google Sheet è³‡æ–™
        fetch(scriptURL)
            .then(res => res.json())
            .then(data => {
                productData = data;
                document.getElementById('loadingStatus').classList.add('hidden');
                data.forEach((p, index) => {
                    const opt = document.createElement('option');
                    opt.value = index;
                    opt.textContent = p.name;
                    select.appendChild(opt);
                });
            })
            .catch(err => {
                console.error('Fetch Error:', err);
                document.getElementById('loadingStatus').innerText = 'è¼‰å…¥å“é …å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯ã€‚';
            });

        // 2. ç•¶é¸æ“‡å“é …æˆ–æ›´æ”¹æ•¸é‡æ™‚ï¼Œæ›´æ–°é è¦½èˆ‡ç¸½é¡
        function updateUI() {
            const product = productData[select.value];
            if (product) {
                preview.classList.remove('hidden');
                document.getElementById('previewImg').src = product.img;
                document.getElementById('previewName').textContent = product.name;
                document.getElementById('previewPrice').textContent = `$${product.price}`;
                document.getElementById('previewSeries').textContent = product.series;
                
                const qty = parseInt(quantityInput.value) || 0;
                totalAmountDisp.textContent = `$${product.price * qty}`;
            } else {
                preview.classList.add('hidden');
                totalAmountDisp.textContent = `$0`;
            }
        }

        select.addEventListener('change', updateUI);
        quantityInput.addEventListener('input', updateUI);

        // 3. æäº¤è¡¨å–®
        form.addEventListener('submit', e => {
            e.preventDefault();
            const btn = document.getElementById('submitBtn');
            btn.disabled = true;
            btn.innerText = 'è¨‚å–®è™•ç†ä¸­...';

            const formData = new FormData(form);
            const index = formData.get('productIndex');
            const selectedProduct = productData[index];

            const payload = {
                name: formData.get('name'),
                phone: formData.get('phone'),
                productName: selectedProduct.name,
                price: selectedProduct.price,
                quantity: formData.get('quantity'),
                note: formData.get('note')
            };

            // ä½¿ç”¨ POST é€å‡º
            fetch(scriptURL, {
                method: 'POST',
                mode: 'no-cors', // è™•ç†è·¨ç¶²åŸŸ
                body: JSON.stringify(payload)
            }).then(() => {
                form.classList.add('hidden');
                document.getElementById('successMsg').classList.remove('hidden');
            }).catch(error => {
                alert('ç™¼ç”ŸéŒ¯èª¤ï¼š' + error.message);
                btn.disabled = false;
                btn.innerText = 'é‡æ–°é€å‡º';
            });
        });
    </script>
</body>
</html>
